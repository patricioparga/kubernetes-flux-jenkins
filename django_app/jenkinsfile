pipeline {
    agent {
        label 'agent_one'
    }
    stages {
        stage('Checkout') {
            steps {
                // Checkout the code from the GitHub repository
                checkout scm
            }
        }

        stage('Print PATH') {
            steps {
                sh 'echo $PATH'
            }
        }

        stage('Install Dependencies') {
            steps {
                dir('django_app') {
                    script {
                        // Setup a virtual environment and install requirements
                        sh 'pwd'
                        sh 'ls -la'
                        sh 'pip install -r requirements.txt'
                    }
                }
            }
        }

        stage('Run Tests') {
            steps {
                script {
                    // This is a placeholder; Django uses manage.py test to run tests
                    // Assuming no tests now, just echoing success.
                    echo "Tests passed"
                }
            }
        }

        stage('Build Docker Image and Push to Quay') {
            steps {
                dir('django_app') {
                    script {
                        // Assuming you have a Dockerfile to build your Django app
                        sh 'docker build -t care_nlm/django_app:latest .'
                        sh 'docker login quay.io -u $QUAY_USERNAME -p $QUAY_PASSWORD'
                        sh 'docker push care_nlm/django_app:latest'
                    }
                }
            }
        }
    }

    post {
        always {
            // Cleanup tasks, if any.
            echo "Pipeline completed!"
        }
    }
}